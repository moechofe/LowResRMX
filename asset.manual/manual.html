<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<title>LowResRMX Manual</title>
<style>
body { font-family: 'Baskerville', 'Libre Baskerville', serif; font-size: 1.3em; margin: 0; }
h1, h2, h3 { margin: 2.5em 0 1em 0; background: #444; color: #fff; padding: 0.6em 1em 0.4em 1em; }
body h1 { margin-top: 0; }
p { margin: 1em; }
blockquote { margin: 1em 0; border-left: solid 1em #ecc; padding: 0.2em 0.4em; background-color: #fee; }
code { background-color: #ccc; padding: 0.2em 0.3em; margin: -0.2em -0.1em; }
code+code { display: inline-block; }
pre { white-space: pre-wrap; font-family: 'Menlon-Regular', monospace; margin: 0; background-color: #ccc; padding: 0.5em 1em; display: inline-block; -moz-tab-size:2; -o-tab-size:2; tab-size:2; }
pre>code { padding: 0; margin: 0; }
blockquote>pre { margin-left: 1em; }
blockquote pre,blockquote code { background-color: #ecc; }
table { border-collapse: collapse; margin: 0 1em; display: inline-block; }
table+table { margin-left: 2em; vertical-align:top; }
td, th { padding: 0.2em 0.8em; text-align: left; }
tbody>tr, tr+tr { border-top: solid 0.1em #ddd; }
hr { border: none; border-top: solid 0.15em #ccc; margin: 1em; }
</style>
</head>
<body>



<!-- Tool: https://markdowntohtml.com/ -->
<!-- and replace <br /> by <br /> and <hr /> by <hr /> -->
<!-- &#39; ' -->

<h1 id="lowresrmx-manual">LowResRMX manual</h1>
<blockquote>
<p>This is a fork of the excellent fantasy console Lowres NX by Timo &quot;Inutilis&quot; Kloss.<br />
This is a heavily modified version and way more complicated to use, I recommend you to stay on the original app:
<a href="https://apps.apple.com/app/lowres-nx-coder/id1318884577">LowRes NX Coder on App Store</a>.</p>
</blockquote>
<!-- FIXME: spell checked start -->
<p>Create your games and play them on the go using an iPhone or iPad. LowResRMX is a virtual game console and game development environment that includes all the tools you need to start and finish a project.</p>
<p>It <strong>will</strong> includes a project manager, a code editor, and various tools to edit game assets: sprites, palettes, backgrounds, instruments, and music.</p>
<blockquote>
<p><strong>The documentation and included tools are still in development.</strong></p>
</blockquote>
<h2 id="difference-with-lowres-nx">Difference with Lowres NX</h2>
<p>The goal ü•Ö of the app is to provide a development environment that I can use during my commutes on the subway, and later, to be able to publish a real app on the stores.</p>
<p>The original LowRes NX, despite being an excellent development environment, lacks some capabilities, in my opinion.</p>
<h3 id="background">Background</h3>
<p>4 background layers instead of 2, with 64x64 cells instead of 32x32.</p>
<p>Support for large 16x16 pixel cells has been removed.</p>
<p>Removed üóëÔ∏è syntaxes:</p>
<p><code>CELL SIZE bg,size</code></p>
<hr />
<p>Alternative syntax for the <code>FLIP</code> command:</p>
<p><code>FLIP x,y</code></p>
<p>Where <code>x</code> and <code>y</code> are both optional and can accept any number. If the number is different from zero, the flag will be set.</p>
<h3 id="screen">Screen</h3>
<p>A fantasy screen with a resolution of 216x384 pixels.</p>
<p>It features perfectly square pixels, a fixed portrait orientation, and always fills the entire device screen.</p>
<p>Depending on the device's screen ratio, the number of visible virtual pixels may vary‚Äîfrom 216x288 on 4:3 devices to 177x384 on 19.5:9 devices.</p>
<p>To detect the visible virtual pixels, use the new functions <code>=SHOWN.W</code> and <code>=SHOWN.H</code>.</p>
<hr />
<p>New functions to retrieve the visible fantasy display size:</p>
<p><code>=SHOWN.W</code><br />
<code>=SHOWN.H</code></p>
<p>Returns the number of visible pixels in width and height respectively.</p>
<hr />
<p>New functions to query the safe area offset:</p>
<p><code>=SAFE.L</code><br />
<code>=SAFE.T</code><br />
<code>=SAFE.R</code><br />
<code>=SAFE.B</code></p>
<p>These return the offset in virtual pixels to apply from the boundary of the fantasy device screen to reach the inner safe area specified by the device's operating system.</p>
<p>These functions can be used to avoid the top camera notch or the bottom inset full-width buttons.</p>
<h3 id="colors">Colors</h3>
<p>The 64 available colors do not follow the original EGA style of LowRes NX. Instead, they use the <a href="https://lospec.com/palette-list/famicube">FAMICUBE palette created by Arne</a>.</p>
<blockquote>
<p>This makes using the color chooser from the original &quot;Gfx Designer&quot; in LowRes NX a bit more challenging.</p>
</blockquote>
<hr />
<p>New settings with the <code>SYSTEM</code> command:</p>
<p><code>SYSTEM setting,opacity</code>
<br />where <code>setting</code> ranges from <code>1</code> to <code>4</code>.</p>
<p>This allows you to make color <code>0</code> of the background layer opaque instead of transparent.</p>
<table>
<thead>
<tr>
<th>setting</th>
<th>background</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
</tr>
<tr>
<td>4</td>
<td>3</td>
</tr>
</tbody>
</table>
<h3 id="sprites">Sprites</h3>
<p>170 sprites instead of 64.<br />
Sprite number range from <code>0</code> to <code>169</code>.</p>
<p>Positions support sub-pixels with <code>1/16</code> pixel precision.</p>
<p>e.g.:</p>
<pre><code>SPRITE <span class="hljs-number">123</span>,SPRITE.X(<span class="hljs-number">123</span>)+<span class="hljs-number">0.25</span>,
</code></pre><h3 id="input">Input</h3>
<p>Touchscreen only, with floating-point precision.</p>
<p>The virtual controller and the ability to use a Bluetooth controller have been removed.</p>
<p>The virtual keyboard is still available.</p>
<p>When the device's virtual keyboard is hidden by the user, the corresponding I/O <a href="#registers">Registers</a> flag is updated.</p>
<p>Removed üóëÔ∏è syntaxes:</p>
<p><code>=BUTTON(p,n)</code>, <code>=UP(p)</code>, <code>=DOWN(p)</code>, <code>=LEFT(p)</code>, <code>=RIGHT(p)</code>, <code>GAMEPAD n</code>, <code>TOUCHSCREEN</code></p>
<hr />
<p>Changes to the <code>=TOUCH.X</code> and <code>=TOUCH.Y</code> functions: These now return floating-point values.</p>
<hr />
<p>New alternative to the <code>WAIT</code> command:</p>
<p><code>WAIT TAP</code></p>
<p>This will wait until a device tap is detected but will still render the screen.</p>
<h3 id="flow-control">Flow control</h3>
<p>New program flow control:</p>
<p><code>ON value GOTO label,..</code><br />
<code>ON value GOSUB label,..</code><br />
<code>ON value RESTORE label,..</code></p>
<p>These commands will <code>GOTO</code>, <code>GOSUB</code> or <code>RESTORE</code> to one of the listed <code>label</code>s based on the <code>value</code>.</p>
<p>e.g.:</p>
<pre><code>ON I GOTO <span class="hljs-literal">ZERO</span>,<span class="hljs-literal">ONE</span>,<span class="hljs-literal">TWO</span>
</code></pre><h3 id="data">Data</h3>
<p>New keyword to skip read data:</p>
<p><code>SKIP number</code></p>
<p>This will skip a specified <code>number</code> of data entries, so they are not read.</p>
<p>e.g.:</p>
<pre><code>DATA 0,1,2
<span class="hljs-keyword">SKIP </span>2
READ A
PRINT A
'WILL PRINT "2"
</code></pre><hr />
<p>It's now possible to access data directly using its label:</p>
<p><code>PRINT label</code></p>
<p>This allows you to store a string using the <code>DATA</code> keyword and reference it in the <code>PRINT</code> command.</p>
<p>e.g.:</p>
<pre><code>PRINT TEST
<span class="hljs-keyword">TEST:
</span>DATA "GABUZOMEU"
</code></pre><p>It also works in variables, functions, and commands:</p>
<pre><code>A<span class="hljs-variable">$=</span>TEST+LEFT<span class="hljs-variable">$(</span>TEST,<span class="hljs-number">2</span>)
</code></pre><p>Numeric values are supported as well:</p>
<pre><code>TEST2:
<span class="hljs-keyword">DATA</span> <span class="hljs-number">123.4</span>
<span class="hljs-built_in">PRINT</span> TEST2*<span class="hljs-number">3</span>
</code></pre><h3 id="math">Math</h3>
<p>New function to clamp a numerical value:</p>
<p><code>=CLAMP(value,min,max)</code></p>
<p>This returns the <code>value</code> clamped between <code>min</code> and <code>max</code>.</p>
<hr />
<p>New random generator and features:</p>
<p><code>=RND</code></p>
<p>Works the same as before but with a different generator, using <a href="https://www.pcg-random.org/">PCG</a>.</p>
<p><code>RANDOMIZE seed,address</code>
<code>=RND address</code>
<code>=RND(max,address)</code></p>
<p>You can specify an <code>address</code> where the internal state will be stored, consuming 16 bytes.</p>
<p>This allows you to use multiple generators at the same time.</p>
<hr />
<p>New syntax to compute length:</p>
<p><code>=LEN(x,y)</code></p>
<p>Calculates the length of a 2D vector using <code>x</code> and <code>y</code> as the coordinates for the two axes.</p>
<hr />
<p>New function that interpolate values between <code>0</code> and <code>1</code> using easing mathematical functions:</p>
<p><code>=EASE(function,mode,value)</code></p>
<p>This returns the interpolation of <code>value</code> between 0.0 and 1.0, using the specified easing <code>function</code> and <code>mode</code>.</p>
<table>
<thead>
<tr>
<th></th>
<th>function</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>linear</td>
</tr>
<tr>
<td>1</td>
<td>sine</td>
</tr>
<tr>
<td>2</td>
<td>quad</td>
</tr>
<tr>
<td>3</td>
<td>cubic</td>
</tr>
<tr>
<td>4</td>
<td>quart</td>
</tr>
<tr>
<td>5</td>
<td>quint</td>
</tr>
<tr>
<td>6</td>
<td>circ</td>
</tr>
<tr>
<td>7</td>
<td>back</td>
</tr>
<tr>
<td>8</td>
<td>elastic</td>
</tr>
<tr>
<td>9</td>
<td>bounce</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th></th>
<th>mode</th>
</tr>
</thead>
<tbody>
<tr>
<td>-1</td>
<td>in</td>
</tr>
<tr>
<td>0</td>
<td>inout</td>
</tr>
<tr>
<td>+1</td>
<td>out</td>
</tr>
</tbody>
</table>
<h3 id="text">Text</h3>
<p>New command to expose the existing overlay message API:</p>
<p><code>MESSAGE text</code></p>
<h3 id="other">Other</h3>
<p>New command to support programs from the original LowRes NX:</p>
<p><code>COMPAT</code></p>
<blockquote>
<p>Note: This command will be removed at some point. Some commands from LowRes NX are already unavailable.</p>
</blockquote>
<p>Enables compatibility mode:</p>
<ul>
<li>Forces the rendering process to keep the original device screen.</li>
<li>Reverts the <code>RND</code> command and <code>=RND()</code> function to their original behavior.</li>
</ul>
<p>This does not guarantee full compatibility but can help with some aspects.</p>
<p>For instance, commands and functions that have been removed will still be unavailable.</p>
<p>TODO: about double cells</p>
<!-- FIXME: spell checked end -->
<hr />
<p>Removed üóëÔ∏è commands:</p>
<p><code>DISPLAY</code></p>
<p>Removed üóëÔ∏è reserved keywords:</p>
<p><code>ANIM</code>, <code>CLOSE</code>, <code>DECLARE</code>, <code>DEF</code>, <code>FLASH</code>, <code>FN</code>, <code>FUNCTION</code>, <code>LBOUND</code>, <code>OPEN</code>, <code>OUTPUT</code>, <code>SHARED</code>, <code>STATIC</code>, <code>TEMPO</code>, <code>VOICE</code>, <code>WRITE</code></p>
<h3 id="memory">Memory</h3>
<p>An almost compatible memory mapping.</p>
<p>The total addressable memory grow from 64 Kibi to 128 Kibi.</p>
<p>Lowres NX:</p>
<table>
<thead>
<tr>
<th>addr</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>$0000</td>
<td>32 Kibi</td>
<td>Cartridge ROM</td>
</tr>
<tr>
<td>$8000</td>
<td>4 Kibi</td>
<td>Character Data</td>
</tr>
<tr>
<td>$9000</td>
<td>2 Kibi</td>
<td>BG0 Data</td>
</tr>
<tr>
<td>$9800</td>
<td>2 Kibi</td>
<td>BG1 Data</td>
</tr>
<tr>
<td>$A000</td>
<td>16 Kibi</td>
<td>Working RAM</td>
</tr>
<tr>
<td>$E000</td>
<td>4 Kibi</td>
<td>Persistent RAM</td>
</tr>
<tr>
<td>$FE00</td>
<td>256 Bytes</td>
<td>Sprite Registers</td>
</tr>
<tr>
<td>$FF00</td>
<td>32 Bytes</td>
<td>Color Registers</td>
</tr>
<tr>
<td>$FF20</td>
<td></td>
<td>Video Registers</td>
</tr>
<tr>
<td>$FF40</td>
<td></td>
<td>Audio Registers</td>
</tr>
<tr>
<td>$FF70</td>
<td></td>
<td>I/O Registers</td>
</tr>
</tbody>
</table>
<p>LowResRMX:</p>
<table>
<thead>
<tr>
<th>addr</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>$0000</td>
<td>8 Kibi</td>
<td>BG0 data</td>
</tr>
<tr>
<td>$2000</td>
<td>8 Kibi</td>
<td>BG1 data</td>
</tr>
<tr>
<td>$4000</td>
<td>8 Kibi</td>
<td>BG2 data</td>
</tr>
<tr>
<td>$6000</td>
<td>8 Kibi</td>
<td>BG3 data</td>
</tr>
<tr>
<td>$8000</td>
<td>4 Kibi</td>
<td>Character Data</td>
</tr>
<tr>
<td>$9000</td>
<td>20 Kibi</td>
<td>Working RAM</td>
</tr>
<tr>
<td>$E000</td>
<td>6 Kibi</td>
<td>Persisent RAM</td>
</tr>
<tr>
<td>$FB00</td>
<td>1020 Bytes</td>
<td>Sprite registers</td>
</tr>
<tr>
<td>$FF00</td>
<td>32 Bytes</td>
<td>Color registers</td>
</tr>
<tr>
<td>$FF20</td>
<td>10 Bytes</td>
<td>Video registers</td>
</tr>
<tr>
<td>$FF40</td>
<td>48 Bytes</td>
<td>Audio registers</td>
</tr>
<tr>
<td>$FF70</td>
<td>40 Bytes</td>
<td>I/O registers</td>
</tr>
<tr>
<td>$FFA0</td>
<td>6 Bytes</td>
<td>DMA registers</td>
</tr>
<tr>
<td>$10000</td>
<td>64 Kibi</td>
<td>Cartridge ROM</td>
</tr>
</tbody>
</table>
<p>TODO: Add particle/emitter registers</p>
<hr />
<p>New command and registers for a fast memory copy.</p>
<p><code>DMA COPY</code><br />
<code>DMA COPY ROM</code></p>
<p>Perform a fast memory copy that can be done only during interrupt calls.</p>
<p>It uses the following registers as data:</p>
<table>
<thead>
<tr>
<th>addr</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>$FFA0</td>
<td>Source address</td>
</tr>
<tr>
<td>$FFA2</td>
<td>Bytes count</td>
</tr>
<tr>
<td>$FFA4</td>
<td>Destination address</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Will only works in a subprogram that has been called during an interrupts, including: <code>RASTER</code>, <code>VBL</code> and <code>PARTICLE</code>.</p>
</blockquote>
<hr />
<p>The <code>COPY</code> command is slightly faster.</p>
<h3 id="particles">Particles</h3>
<p>The particles library reused the sprites to make them appear, dissapear, change theirs characters data and move them accross the screen.</p>
<hr />
<p><code>PARTICLE first,count AT address</code></p>
<p>Declare to use <code>count</code> sprites starting from the <code>first</code> and store the internal data at <code>address</code>.</p>
<p>It will consume 6 bytes per sprite in memory. For each sprite:</p>
<table>
<thead>
<tr>
<th>addr</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>+0</td>
<td>2 Bytes</td>
<td>Speed on x axis</td>
</tr>
<tr>
<td>+2</td>
<td>2 Bytes</td>
<td>Speed on y axis</td>
</tr>
<tr>
<td>+4</td>
<td>1 Byte</td>
<td>Appearence</td>
</tr>
<tr>
<td>+5</td>
<td>1 Byte</td>
<td>Current frame</td>
</tr>
</tbody>
</table>
<p>e.g.:</p>
<pre><code>PARTICLE <span class="hljs-number">1</span>,<span class="hljs-number">20</span> AT $<span class="hljs-number">9000</span>
'Will use sprite <span class="hljs-number">1</span> to <span class="hljs-number">20</span> included.
'Store internal data from $<span class="hljs-number">9000</span> to $<span class="hljs-number">9078</span> excluded.
</code></pre><hr />
<p><code>PARTICLE appearance DATA label</code></p>
<p>Declare a <code>label</code> that contains DATA for the particle <code>appearance</code>.</p>
<p><code>appearance</code> is a number between 0 and 23.</p>
<p>The associated DATA must contains a list of character number that will be used to draw the particle. Using a negative number will loop to the previous DATA value.</p>
<p>A typical example is to put zero <code>0</code> and minus one <code>-1</code> for the two last data values, as it will allow to make the particle dissapear until the sprite is reused.</p>
<p>e.g.:</p>
<pre><code>MY_APPEARANCE:
DATA <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>
<span class="hljs-symbol">'Will</span> show the <span class="hljs-built_in">character</span> <span class="hljs-number">1</span> <span class="hljs-keyword">to</span> <span class="hljs-number">4</span>, each per frame.
<span class="hljs-symbol">'And</span> <span class="hljs-keyword">loop</span> <span class="hljs-keyword">with</span> the <span class="hljs-built_in">character</span> <span class="hljs-number">0</span>.
</code></pre><hr />
<p><code>PARTICLE OFF</code></p>
<p>Clear each sprite position and each particle appearance.</p>
<hr />
<p><code>ON PARTICLE CALL subprogram</code></p>
<p>For each particle, will call the subprogram using an interrupt.</p>
<p>The target <code>subprogram</code> will receive two arguments:</p>
<ol>
<li>the <code>sprite</code> number,</li>
<li>and the particle <code>address</code>.</li>
</ol>
<p>e.g.:</p>
<pre><code><span class="hljs-keyword">SUB</span> MYPART(SPR,ADDR)
    SY=PEEKW(ADDR+<span class="hljs-number">2</span>)
    POKEW ADDR+<span class="hljs-number">2</span>,SY<span class="hljs-number">-5</span>
    <span class="hljs-comment">'Change the speed in y axis</span>
<span class="hljs-keyword">END</span> <span class="hljs-keyword">SUB</span>
</code></pre><p>TODO: specify the number of cycles available.</p>
<hr />
<p><code>EMITTER count AT address</code></p>
<p>Declare to use <code>count</code> emitter and store the internal data at <code>address</code>.</p>
<p><code>count</code> is a number between 0 and 15.</p>
<p>It will consume 6 bytes per emitter in memory. For each emitter:</p>
<table>
<thead>
<tr>
<th>addr</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>+0</td>
<td>2 Bytes</td>
<td>Position on x axis</td>
</tr>
<tr>
<td>+2</td>
<td>2 Bytes</td>
<td>Position on y axis</td>
</tr>
<tr>
<td>+4</td>
<td>1 Byte</td>
<td>Delay before emit</td>
</tr>
<tr>
<td>+5</td>
<td>1 Byte</td>
<td>Number of time to emit</td>
</tr>
</tbody>
</table>
<hr />
<p><code>EMITTER emitter DATA label</code></p>
<p>Declare a <code>label</code> that contains DATA for the <code>emitter</code>.</p>
<p>The associated data must follow this list:</p>
<ol>
<li><code>appearance</code>,</li>
<li><code>outer</code> ring radius,</li>
<li><code>inner</code> ring radius,</li>
<li>initial particle <code>speed</code> on x axis,</li>
<li>initial particle <code>speed</code> on y axis,</li>
<li><code>count</code> of the number of particle to spawn at this frame,</li>
<li>number of frame to <code>delay</code> the re-emittion,</li>
<li>how many times to <code>repeat</code> the emittion.</li>
</ol>
<p>When a particle get spawn, a random position is computed between the <code>outer</code> and <code>inner</code> ring.</p>
<hr />
<p><code>EMITTER emitter ON x,y</code></p>
<p>Tell the <code>emitter</code> to emit particle staring at position <code>x</code> and <code>y</code>.</p>
<p>It will automaticly end when <code>repeat</code> reach 0.</p>
<hr />
<p><code>EMITTER emitter OFF</code></p>
<p>Manually stop the <code>emitter</code>.</p>
<h1 id="how-does-it-works">How does it works</h1>
<!--FIXME: spell checked NOW -->
<p>LowResRMX does not have a framebuffer where users paint pixels. Instead, it simulates an NES/Gameboy PPU chip, which traverses its memory to generate output pixels based on characters, backgrounds, sprites, palettes and register information.</p>
<h3 id="colors">Colors</h3>
<p>LowResRMX provides the user with a fixed set of 64 colors.
The colors are grouped into sets of 4 called palette, with 8 palettes available for users to colorize their creations.</p>
<p>The 1st color of the 1st palette will be used as the background color for the whole program. For the following palettes (2nd to 8th), the 1st color is transparent.</p>
<blockquote>
<p>But this can be altered by the <code>SYSTEM</code> command.</p>
</blockquote>
<p>From now on, the terms:</p>
<ul>
<li><strong>a palette</strong> apply to one of the 8 palettes with 4 colors inside,</li>
<li><strong>a color</strong> means one of the 4 colors within a palette.</li>
</ul>
<p>Check color <a href="#Registers">registers</a> for information about the memory mapping and data format.</p>
<h3 id="characters">Characters</h3>
<p>The 256 characters available in the dedicated memory are 8x8 pixels each and are assigned a number from 0 to 255.
Whenever this number is encountered in the background or sprite, the rendering process will draw the corresponding block of 8x8 pixels.</p>
<p>From now on, the term:</p>
<ul>
<li><strong>a character</strong> is a block of 8x8 pixels and take 16 bytes.</li>
</ul>
<p>Check character <a href="#Registers">registers</a> for information about the memory mapping and data format.</p>
<h3 id="backgrounds">Backgrounds</h3>
<p>LowResRMX has 4 background layers, each with an independent:</p>
<ul>
<li>X and Y position,</li>
<li>and 64x64 character cells.</li>
</ul>
<p>The 4 layers are drawn in order from 4th to 1st. Cells of the 1st background will be visible above the others unless the priority flag is used.</p>
<p>Each cells have it's own:</p>
<ul>
<li>character number,</li>
<li>palette,</li>
<li>horizontal and vertical flip,</li>
<li>priority to alter which layer's cell is drawn on top of another and on top of sprites.</li>
</ul>
<p>Layers are not framebuffers; you CANNOT easily paint pixels directly. Instead, every cell references a character number, and those hold the pixel color information.</p>
<p>Each layer can be shifted using the position in the X and Y axes. When reaching the edges, the cells will wrap around and remain visible.
Put another way, when the rendering process tries to draw the 65th cell of a row, because it does not exist, it will draw the 1st cell instead. This can be used to achieve infinite scrolling.</p>
<p>As mentioned before, the 1st color of each palette is transparent except for the 1st color of the 1st palette. It will determine the background color of the whole fantasy screen.</p>
<blockquote>
<p>But this can be altered by the <code>SYSTEM</code> command.</p>
</blockquote>
<p>From now on, the terms:</p>
<ul>
<li><strong>a bg</strong> is a layer of 64x64 cells,</li>
<li><strong>a cell</strong> is a region of a bg that shows a character.</li>
</ul>
<p>Check background <a href="#Registers">registers</a> for information about the memory mapping and data format.</p>
<blockquote>
<p><a href="#background-api">Backgrounds dedicated procedures and functions</a></p>
</blockquote>
<h3 id="sprites">Sprites</h3>
<p>LowResRMX offers 170 sprites, each with:</p>
<ul>
<li>and Y position,</li>
<li>a size of 8x8, 16x16, 24x24 or 32x32 pixels,</li>
<li>a character number for the top left one,</li>
<li>a palette,</li>
<li>horizontal and vertical flip,</li>
<li>and priority to show the sprite on top of bg cells with priorities.</li>
</ul>
<p>The 170 sprites are drawn in order from 170th (bottom) to 1st (top).</p>
<p>Sprites are groups of characters ranging from 1x1 to 4x4. The difference with bg is that you only choose the top-left character. The other character numbers are dependent on the top-left one.</p>
<p>Here's an explaination:</p>
<p>In memory, characters are grouped by 16 per row with 16 rows, called the spritesheet.</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>00</code></td>
<td><code>01</code></td>
<td>‚Ä¶</td>
<td><code>0e</code></td>
<td><code>0f</code></td>
</tr>
<tr>
<td><strong><code>10</code></strong></td>
<td><strong><code>11</code></strong></td>
<td>‚Ä¶</td>
<td><code>1e</code></td>
<td><code>1f</code></td>
</tr>
<tr>
<td><strong><code>20</code></strong></td>
<td><strong><code>21</code></strong></td>
<td>‚Ä¶</td>
<td><code>2e</code></td>
<td><code>2f</code></td>
</tr>
<tr>
<td><code>30</code></td>
<td><code>31</code></td>
<td>‚Ä¶</td>
<td><code>3e</code></td>
<td><code>3f</code></td>
</tr>
<tr>
<td></td>
<td></td>
<td>‚Ä¶</td>
<td></td>
</tr>
</tbody>
</table>
<p>For a sprite with a size of 2x2 characters, and the top-left one is the number <code>10</code> in hexadecimal, the other characters will be the ones to its right and below it, so: <code>11</code>, <code>20</code>, and <code>21</code>.</p>
<p>A sprite can be freely placed anywhere on the screen with 1/16 sub-pixel precision. This means you can add 0.5 to its position even if there will be no change visually.</p>
<p>From now on, the terms:</p>
<ul>
<li><strong>a sprite</strong> is a group of 1x1 to 4x4 character,</li>
<li><strong>the spritesheet</strong> is the whole 16x16 characters available.</li>
</ul>
<!--FIXME: spell checked END -->
<h1 id="program-language">Program Language</h1>
<p>The programming language follow the path of the original Lowres NX. It's a BASIC type language and here's how to use it.</p>
<h3 id="program">Program</h3>
<p>A program is a list of so called instructions and executed by the fantasy console one by one from top to bottom. The simplest and iconic program could be:</p>
<pre><code><span class="hljs-built_in">print</span> <span class="hljs-string">"hello world!"</span>
</code></pre><p>Users are invited to create a new program, types the instructions above and run it.</p>
<p>Keywords and values are separated by spaces and instructions with new line.</p>
<pre><code><span class="hljs-built_in">print</span> <span class="hljs-string">"hello..."</span>
<span class="hljs-built_in">print</span> <span class="hljs-string">"second instruction"</span>
</code></pre><blockquote>
<p>The program do not care about upper or lower case, use the one you prefers.</p>
</blockquote>
<h3 id="identifiers">Identifiers</h3>
<p>An identifier is a word defined by the user that represent an idea inside the program and they are used to declare variables, labels or procedures (more on those terms later), e.g.: <code>hero</code>, <code>enemies</code>, <code>HP</code>, <code>score</code>, <code>spawn_monsters</code>, <code>update_screen</code>, <code>collect_coins</code>, <code>level12</code>‚Ä¶</p>
<p>Valid characters for identifiers art ASCII letters, digits and the underscore <code>_</code>. But they CANNOT start by a digits and they CANNOT have more than 21 characters.</p>
<blockquote>
<p>Important: Not all identifiers are valid because some of them are reserved by the language itself, check the <a href="#keywords">list of reserved keywords</a> and learn them to avoid common mistakes</p>
</blockquote>
<h3 id="variables">Variables</h3>
<p>A variables is a value that retains in the memory fantasy console as long as the program is running. They can be used to store positions, scores, HP and all sort of information that users can think of. The purpose of variable is to store a value inside to get it back later.</p>
<p>Example: think of a score counter that start at zero and increment every time a plumber hero jump on enemies heads. A nice name for this value can be <code>score</code> and can be declared like this:</p>
<pre><code><span class="hljs-attr">score</span>=<span class="hljs-number">0</span>
</code></pre><p>And to increment it:</p>
<pre><code><span class="hljs-attr">score</span>=score+<span class="hljs-number">1</span>
</code></pre><p>As you can see, variables are declared using an identifier, that why user should take care of giving them a nice name that help them remember what's inside.</p>
<p>As real example, this is a program that increment and print a score every time the player tap the device screen.</p>
<pre><code><span class="hljs-keyword">score</span>=0
<span class="hljs-keyword">do</span>
    <span class="hljs-keyword">print</span> <span class="hljs-string">"score"</span>,<span class="hljs-keyword">score</span>
    wait tap
    <span class="hljs-keyword">score</span>=<span class="hljs-keyword">score</span>+1
loop
</code></pre><p>Variable can also store strings:</p>
<pre><code><span class="hljs-built_in">name</span>$=<span class="hljs-string">"Untel"</span>
print <span class="hljs-built_in">name</span>$
</code></pre><h3 id="values">Values</h3>
<p>Identifiers can store two types of value: number and string.</p>
<p>Numbers can be integer or decimal, e.g.: <code>123</code>, <code>-45</code>, <code>0.01</code>, <code>12345.6789</code></p>
<p>String can only contains ASCII7 characters: letters, digits, some punctuations and some control characters: <code>&quot;hello WORLD! 123&quot;</code></p>
<blockquote>
<p>Learn more about the technical information about <a href="#number">number type</a> and <a href="#string">string type</a>.</p>
</blockquote>
<h3 id="labels">Labels</h3>
<p>Another feature that used identifiers are labels. They are used to mark a position in the program to go back to it later. User have to understand that programs are executed line by line from top to bottom and labels are one solution to go back to the top of the program or anywhere else (almost).</p>
<p>Here is an example that demonstrate how to recreate the program above using labels:</p>
<pre><code><span class="hljs-built_in">score</span>=<span class="hljs-number">0</span>
start:
    print <span class="hljs-string">"score"</span>,<span class="hljs-built_in">score</span>
    wait tap
    <span class="hljs-built_in">score</span>=<span class="hljs-built_in">score</span>+<span class="hljs-number">1</span>
<span class="hljs-built_in">goto</span> start
</code></pre><p>A label is declared by an identifier followed by a coma <code>:</code>.</p>
<h3 id="procedures">Procedures</h3>
<p>The last usage of identifiers are procedures. They means to be reusable sub-part of a program.</p>
<p>Here's a quick example:</p>
<pre><code><span class="hljs-keyword">sub </span><span class="hljs-keyword">addition(a,b,c)
</span>    c<span class="hljs-symbol">=a</span>+<span class="hljs-keyword">b
</span><span class="hljs-symbol">end</span> <span class="hljs-keyword">sub</span>
</code></pre><p>By running this program, nothing will happens because procedures do not get executed automaticly. Instead the user must use a dedicated command for it:</p>
<pre><code><span class="hljs-literal">result</span>=<span class="hljs-number">0</span>
call addition(<span class="hljs-number">120</span>,<span class="hljs-number">3</span>,<span class="hljs-literal">result</span>)
print <span class="hljs-string">"result"</span>,<span class="hljs-literal">result</span>
</code></pre><p>By adding this piece of code after the previous one and run the program, the solution of the operation 120+3 will be printed on the screen: <code>RESULT 123</code>.</p>
<p>The advantage of <em>calling</em> proceduces is to be able to do it again and again.</p>
<pre><code><span class="hljs-keyword">call</span> addition(<span class="hljs-number">45</span>,<span class="hljs-number">-78</span>,<span class="hljs-keyword">result</span>)
print <span class="hljs-string">"result"</span>,<span class="hljs-keyword">result</span>
</code></pre><p>This time, it will print <code>RESULT -33</code>.</p>
<p>TODO: link to SUB/EXIT SUB/END SUB</p>
<p>TODO: link to CALL</p>
<h3 id="parameters-arguments-and-scopes">Parameters, arguments and scopes</h3>
<p>An other concept that came with procedures are the parameters and the arguments but first, users have to learn as thing about variable's scope.</p>
<p>By default, when declaring a variable in a program is scope is limited and are unknown inside a procedure. e.g.:</p>
<pre><code><span class="hljs-keyword">score=0
</span><span class="hljs-keyword">sub </span>print_score
    print <span class="hljs-string">"score"</span>,<span class="hljs-keyword">score
</span>end <span class="hljs-keyword">sub
</span>call print_score
</code></pre><p>This program will produce an error by running it: <code>variable not initialized</code>. The program can't access the variable <code>score</code> inside the <code>print_score</code> proceduce.</p>
<p>One option is to <em>pass</em> the variable to the proceduce. Two changes must be made for that.</p>
<ol>
<li><p>User need to add a parameter to the proceduce declaration:</p>
<pre><code> <span class="hljs-keyword">sub</span> print_score(s)
     print <span class="hljs-string">"score"</span>,s
 <span class="hljs-keyword">end</span> <span class="hljs-keyword">sub</span>
</code></pre></li>
<li><p>User also need to add an argument to the proceduce call:</p>
<pre><code> call print_score(<span class="hljs-name">score</span>)
</code></pre></li>
</ol>
<p>When the proceduce <code>print_score</code> is called, the argument <code>score</code> is <em>passed</em> to the proceduce inside the <code>s</code> argument.</p>
<p>The variable <code>s</code> inside the proceduce is called a <em>local</em> variable and again, it is not accessible from the program out of the proceduce.</p>
<p>Other subject, parameters are passed by reference, it's means that a variable passed to a proceduce and being modified by this procedure will stay modified by the execute exit the proceduce.</p>
<p>Here's an example:</p>
<pre><code>sub modify_it(<span class="hljs-name">a</span>)
    a=123
end sub
my_value=0
call modify_it(<span class="hljs-name">my_value</span>)
print my_value
</code></pre><p>It will print <code>123</code></p>
<h3 id="array">Array</h3>
<p>Arrays are list of values grouped into one variable:</p>
<pre><code>dim player_score(<span class="hljs-number">1</span>)
<span class="hljs-function"><span class="hljs-title">player_score</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span>=<span class="hljs-number">123</span>
<span class="hljs-function"><span class="hljs-title">player_score</span><span class="hljs-params">(<span class="hljs-number">1</span>)</span></span>=<span class="hljs-number">456</span>
</code></pre><p>Arrays are zero-based indexed.</p>
<p>Arrays can also store strings:</p>
<pre><code>dim player_name<span class="hljs-variable">$(</span><span class="hljs-number">1</span>)
player_name<span class="hljs-variable">$(</span><span class="hljs-number">0</span>)=<span class="hljs-string">"Untel"</span>
player_name<span class="hljs-variable">$(</span><span class="hljs-number">1</span>)=<span class="hljs-string">"John Doe"</span>
</code></pre><p>TODO: Link DIM UBOUND</p>
<h3 id="global-scope">Global scope</h3>
<p>When variables are declared in the main program body, they are local to the program body.</p>
<p>When variables are declared inside a proceduc body, they are local to this procedure body.</p>
<p>It is possible to declare a variable global so it can be accessed in both scopes.</p>
<pre><code><span class="hljs-keyword">global</span> <span class="hljs-keyword">score</span>
sub frag
    <span class="hljs-keyword">score</span>=<span class="hljs-keyword">score</span>+1
end sub
<span class="hljs-keyword">do</span>
    cls
    <span class="hljs-keyword">print</span> <span class="hljs-string">"score:"</span>,<span class="hljs-keyword">score</span>
    wait tap
    call frag
loop
</code></pre><blockquote>
<p>They have to be declare in the main program before any procedure that use it is called.</p>
</blockquote>
<p>The syntaxe to declare a global array is a bit different:</p>
<pre><code><span class="hljs-keyword">dim</span> <span class="hljs-keyword">global</span> enemies
</code></pre><p>TODO: link GLOBAL</p>
<h3 id="comments">Comments</h3>
<p>Comments are piece of text that is not executed. They are usefull for taking notes of what a particular piece of code is doing.</p>
<pre><code>'get <span class="hljs-section">touch</span> position in cells coordinates
tx=<span class="hljs-section">touch</span>.x\<span class="hljs-number">8</span>
</code></pre><blockquote>
<p>Ever avoid Captain Obvious comment</p>
</blockquote>
<h3 id="grammar">Grammar</h3>
<p>As say earlier, a program is a list of instructions read and executed one by one. To make it easier to read, developer use a set of spaces, identations, new lines, comments, proceduces‚Ä¶</p>
<p>Here is a set of rules on how it works:</p>
<ul>
<li><p>an instruction cannot be split on two lines.</p>
<p>  This will not work:</p>
<pre><code>  <span class="hljs-comment">üêûa=</span>
    <span class="hljs-comment">123</span>
</code></pre></li>
<li><p>label are not instruction, user can place instruction on the same line.</p>
<p>  ‚úÖThis will work:</p>
<pre><code>  <span class="hljs-built_in">test</span>: <span class="hljs-built_in">print</span> 123
  <span class="hljs-built_in">wait</span> tap
  goto <span class="hljs-built_in">test</span>
</code></pre></li>
<li><p>the only way to squiz two instructions on one line is to use the <code>:</code> colon separator.</p>
<p>  ‚úÖThis will work:</p>
<pre><code>  x=<span class="hljs-keyword">touch</span>.x : y=<span class="hljs-keyword">touch</span>.y
</code></pre><blockquote>
<p>I recommand to place spaces before and after the <code>:</code> colon until I fix the parsing issue</p>
</blockquote>
</li>
<li><p><code>IF...THEN</code> use a different syntax for on line instruction, and <code>:</code> colon as instruction separator will not work correctly.</p>
<p>  This will not work as intended:</p>
<pre><code>  <span class="hljs-keyword">do</span>
  x=<span class="hljs-number">0</span> : y=<span class="hljs-number">0</span>
  <span class="hljs-keyword">if</span> tap <span class="hljs-keyword">then</span> x=<span class="hljs-keyword">touch</span>.x : ‚ùìy=<span class="hljs-keyword">touch</span>.y
  <span class="hljs-built_in">print</span> x,y
  <span class="hljs-keyword">wait</span> tap
  loop
</code></pre><p>  <code>y=touch.y</code> will always be executed.</p>
</li>
<li><p>Comment can be placed after the <code>:</code> colon instruction separator.</p>
<p>  ‚úÖThis will work:</p>
<pre><code>  a=<span class="hljs-number">123</span> :<span class="hljs-symbol">'Default</span> <span class="hljs-keyword">value</span>
</code></pre></li>
<li><p>Identation as no meaning, user can place them whatever they want.</p>
<p>  ‚úÖThis will work:</p>
<pre><code>              <span class="hljs-built_in">print</span>       <span class="hljs-string">"far"</span>
  <span class="hljs-built_in">print</span> <span class="hljs-string">"near"</span>
</code></pre></li>
<li><p>Check the <a href="#keywords">list of reserved keywords</a>, as user cannot use them for identifiers.</p>
</li>
</ul>
<h3 id="expression">Expression</h3>
<p>TODO: continue</p>
<h1 id="basic-instructions">BASIC instructions</h1>
<p>TODO: continue</p>
<h3 id="flow-control">Flow control</h3>
<p><code>END</code></p>
<p><strong>Stop the execution of the program.</strong></p>
<p>It has the same effect as the execution reach the end of the program.</p>
<hr />
<p><code>IF/THEN/ELSE IF/ELSE/END IF</code></p>
<p><strong>Conditionnaly execute instructions.</strong></p>
<p>Syntax:</p>
<pre><code><span class="hljs-keyword">IF</span> condition <span class="hljs-keyword">THEN</span>
    instruction...
[<span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">IF</span> condition <span class="hljs-keyword">THEN</span>
    instruction...]*
[<span class="hljs-keyword">ELSE</span>
    instruction]
<span class="hljs-keyword">END</span> <span class="hljs-keyword">IF</span>
</code></pre><p>Will execute the list of <code>instructions...</code> if the above <code>condition</code> is true.
The <code>condition</code> must be an <a href="#expression">expression</a>.</p>
<p>It's possible to have multiple <code>ELSE IF</code> blocks but a maximum of one <code>ELSE</code> block is authorized.</p>
<p>Real example of a game that ask playre to guess a number:</p>
<pre><code>again: <span class="hljs-keyword">print</span> <span class="hljs-string">"guess the number"</span>
answer=<span class="hljs-keyword">rnd</span>(<span class="hljs-number">100</span>)
retry: <span class="hljs-keyword">input</span> <span class="hljs-string">"1-100:"</span><span class="hljs-comment">;guess</span>
<span class="hljs-keyword">if</span> guess&lt;<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> guess&gt;<span class="hljs-number">100</span> then
    <span class="hljs-keyword">print</span> <span class="hljs-string">"a number between 1 and 100"</span>
    <span class="hljs-keyword">goto</span> retry
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> guess=answer then
    <span class="hljs-keyword">print</span> <span class="hljs-string">"you got it!"</span>
    <span class="hljs-keyword">print</span>
    <span class="hljs-keyword">goto</span> again
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> guess&lt;answer then
    <span class="hljs-keyword">print</span> <span class="hljs-string">"too low"</span>
    <span class="hljs-keyword">goto</span> retry
<span class="hljs-keyword">else</span>
    <span class="hljs-keyword">print</span> <span class="hljs-string">"too high"</span>
    <span class="hljs-keyword">goto</span> retry
<span class="hljs-keyword">end</span> <span class="hljs-keyword">if</span>
</code></pre><p><strong>Short syntax:</strong></p>
<pre><code><span class="hljs-keyword">IF</span> condition <span class="hljs-keyword">THEN</span> instruction
</code></pre><p>This form only allow one instruction, but it's also shorter.</p>
<p>Real example of the same game with less lines:</p>
<pre><code>again: <span class="hljs-keyword">print</span> <span class="hljs-string">"guess the number"</span>
answer=<span class="hljs-keyword">rnd</span>(<span class="hljs-number">100</span>)
retry: <span class="hljs-keyword">input</span> <span class="hljs-string">"1-100:"</span><span class="hljs-comment">;guess</span>
<span class="hljs-keyword">if</span> guess=answer then
    <span class="hljs-keyword">print</span> <span class="hljs-string">"you got it!"</span>
    <span class="hljs-keyword">print</span>
    <span class="hljs-keyword">goto</span> again
<span class="hljs-keyword">end</span> <span class="hljs-keyword">if</span>
<span class="hljs-keyword">if</span> guess&lt;<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> guess&gt;<span class="hljs-number">100</span> then <span class="hljs-keyword">print</span> <span class="hljs-string">"a number between 1 and 100"</span>
<span class="hljs-keyword">if</span> guess&lt;answer then <span class="hljs-keyword">print</span> <span class="hljs-string">"too low"</span>
<span class="hljs-keyword">if</span> guess&gt;answer then <span class="hljs-keyword">print</span> <span class="hljs-string">"too high"</span>
<span class="hljs-keyword">goto</span> retry
</code></pre><hr />
<p><code>GOTO</code></p>
<p><strong>Jump to a labeled instruction.</strong></p>
<p>Syntax:</p>
<pre><code><span class="hljs-keyword">GOTO</span> <span class="hljs-keyword">label</span>
</code></pre><p>With <code>label</code> being declared somewhere in the program.</p>
<p>Real example of a tool that flip a coin:</p>
<pre><code>again:
    <span class="hljs-keyword">print</span>
    <span class="hljs-keyword">print</span> <span class="hljs-string">"tap to flip a coin"</span>
    <span class="hljs-keyword">wait</span> tap
    coin=<span class="hljs-keyword">rnd</span>(<span class="hljs-number">2</span>)
    <span class="hljs-keyword">if</span> coin=<span class="hljs-number">1</span> then <span class="hljs-keyword">goto</span> heads
    <span class="hljs-keyword">if</span> coin=<span class="hljs-number">2</span> then <span class="hljs-keyword">goto</span> tails
    <span class="hljs-keyword">goto</span> edge
heads:
    <span class="hljs-keyword">print</span> <span class="hljs-string">"heads"</span>
    <span class="hljs-keyword">goto</span> again
tails:
    <span class="hljs-keyword">print</span> <span class="hljs-string">"tails"</span>
    <span class="hljs-keyword">goto</span> again
edge:
    <span class="hljs-keyword">print</span> <span class="hljs-string">"edge of the coin!"</span>
    <span class="hljs-keyword">goto</span> again
</code></pre><hr />
<p><code>GOSUB/RETURN</code></p>
<p><strong>Jump to a sub-routine.</strong></p>
<p>Expect to found a <code>RETURN</code> instruction to go back where it was right after the <code>GOSUB</code>.</p>
<p>The return location is store in a stack allow user to jump to sub-routine inside sub-routine. But the stack is limited. A good habit is to always have one <code>RETURN</code> for each <code>GOSUB</code>.</p>
<p>A common usage of sub-routine is to reuse a piece of code multiple times instead of rewrite it again.</p>
<blockquote>
<p>User should probably put all the sub-routine in one place near the end of the program to enshure they are not executed when not wanted.</p>
</blockquote>
<p>Real example. A score is incremented using time and tap:</p>
<pre><code>score=0
gosub <span class="hljs-keyword">update</span>
t=timer
<span class="hljs-keyword">do</span>
    <span class="hljs-keyword">if</span> timer-t&gt;<span class="hljs-number">30</span> <span class="hljs-keyword">then</span> gosub increase
    <span class="hljs-keyword">if</span> tap <span class="hljs-keyword">then</span> gosub increase
    <span class="hljs-keyword">wait</span> vbl
<span class="hljs-keyword">loop</span>
increase:
    inc score
    t=timer
<span class="hljs-keyword">update</span>:
    <span class="hljs-built_in">text</span> <span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-string">"score:"</span>+<span class="hljs-keyword">str</span>$(score)
    <span class="hljs-keyword">return</span>
</code></pre><p>This example is tricky, there is one <code>RETURN</code>, two labels and three <code>GOSUB</code>. The good habit explain above is broken here, but here is the explaination.</p>
<p>The important things is not the number of <code>RETURN</code> is the number of times the instruction is executed. User have to understand that one <code>GOSUB</code> execution will increase by one the size of the stack, and one execution of <code>RETURM</code> will reduce the same stack by exactly one. Every time the <code>WAIT VBL</code> instruction is reach, the stack size is empty, and that's is good sign. It means that the stack will not be overflowed.</p>
<p>TODO: Difference with SUB</p>
<hr />
<p><code>ON GOTO</code></p>
<p><strong>Jump table.</strong></p>
<p>Jump to one of the listed label according to a value.</p>
<p>Syntax:</p>
<pre><code><span class="hljs-keyword">ON</span> value <span class="hljs-keyword">GOTO</span> label0,label1,label2...
</code></pre><p>Will read the <code>value</code> and jump to:</p>
<ul>
<li>the first label if <code>value</code> equal <code>0</code> zero,</li>
<li>the second label if <code>value</code> equal <code>1</code> one,</li>
<li>...</li>
</ul>
<p>Real example:</p>
<pre><code>again:
    <span class="hljs-keyword">wait</span> <span class="hljs-number">30</span>
    <span class="hljs-keyword">on</span> <span class="hljs-keyword">rnd</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">goto</span> zero,one
zero:
    <span class="hljs-keyword">print</span> <span class="hljs-string">"zero"</span>
    <span class="hljs-keyword">goto</span> again
one:
    <span class="hljs-keyword">print</span> <span class="hljs-string">"one"</span>
    <span class="hljs-keyword">goto</span> again
</code></pre><hr />
<p><code>SUB/EXIT SUB/END SUB</code></p>
<p><strong>Defining a proceduce.</strong></p>
<p>Syntax:</p>
<pre><code><span class="hljs-keyword">SUB</span> name [(parameters...)]
    instruction...
<span class="hljs-keyword">END</span> <span class="hljs-keyword">SUB</span>
</code></pre><p>This will define a procedure called <code>name</code> and can optionnaly received a list of values from the <code>parameters</code> list.</p>
<p>Syntax of the <code>parameters</code> list:</p>
<pre><code>(identifier[<span class="hljs-string">$</span>][<span class="hljs-symbol">()</span>], identifier[<span class="hljs-string">$</span>][<span class="hljs-symbol">()</span>]...)
</code></pre><p>Hm, it's a mess, let's explain this. A parameter is always a <code>identifier</code> and can be followed by the type of value it contains. The list of possibilities are:</p>
<ul>
<li>a number: <code>my_num</code></li>
<li>a string: <code>my_str$</code></li>
<li>an array of number: <code>my_num_array()</code></li>
<li>an array of string: <code>my_str_array$()</code></li>
</ul>
<p>An empty list of <code>parameters</code> is not valid. Simply remove the parenthesis <code>()</code>.</p>
<p>Proceduces are isolated small program that can be executed using the <a href="#CALL"><code>CALL</code> instruction</a>. Isolated because the variables declared inside it's body are local, learn more on <a href="#Parameters, arguments and scopes">scopes</a>. For comparison, the body of sub-routines reached using <code>GOSUB</code> are not isolated.</p>
<p>An other different with the sub-routines is that, the definitions of them are only executed throughout the <a href="#CALL"><code>CALL</code> instruction</a>, so, it is safe to place them anywhere inside the program.</p>
<p>Real example, a game where player need to enter a sequence of digits and computer try to prevent it:</p>
<pre><code><span class="hljs-comment">'perturb player input</span>
<span class="hljs-keyword">sub</span> perturb
    <span class="hljs-keyword">if</span> cursor.x&lt;<span class="hljs-number">10</span> <span class="hljs-keyword">then</span> print str$(rnd(<span class="hljs-number">9</span>));
<span class="hljs-keyword">end</span> <span class="hljs-keyword">sub</span>

<span class="hljs-comment">'handle player input</span>
<span class="hljs-keyword">sub</span> handle(c$)
    a=asc(c$)
    <span class="hljs-keyword">if</span> a=<span class="hljs-number">8</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">call</span> delete
    <span class="hljs-keyword">if</span> a&lt;<span class="hljs-number">48</span> <span class="hljs-keyword">or</span> a&gt;<span class="hljs-number">57</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">exit</span> <span class="hljs-keyword">sub</span>
    <span class="hljs-keyword">if</span> rnd&lt;<span class="hljs-number">0.3</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">call</span> perturb
    <span class="hljs-keyword">if</span> cursor.x&lt;<span class="hljs-number">10</span> <span class="hljs-keyword">then</span> print c$;
<span class="hljs-keyword">end</span> <span class="hljs-keyword">sub</span>

<span class="hljs-comment">'delete last character</span>
<span class="hljs-keyword">sub</span> delete
    <span class="hljs-keyword">if</span> cursor.x=<span class="hljs-number">0</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">exit</span> <span class="hljs-keyword">sub</span>
    locate cursor.x<span class="hljs-number">-1</span>,cursor.y
    <span class="hljs-keyword">text</span> cursor.x,cursor.y,<span class="hljs-string">" "</span>
<span class="hljs-keyword">end</span> <span class="hljs-keyword">sub</span>

<span class="hljs-comment">'check if input is correct</span>
<span class="hljs-keyword">sub</span> check(r$)
    r$=<span class="hljs-string">"       "</span>
    <span class="hljs-keyword">text</span> <span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-string">"       "</span>
    <span class="hljs-keyword">if</span> cursor.x&lt;<span class="hljs-number">10</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">exit</span> <span class="hljs-keyword">sub</span>
    ok=<span class="hljs-number">-1</span>
    <span class="hljs-keyword">for</span> i=<span class="hljs-number">0</span> <span class="hljs-keyword">to</span> <span class="hljs-number">9</span>
        <span class="hljs-keyword">if</span> cell.c(i,<span class="hljs-number">1</span>)<span class="hljs-number">-208</span>&lt;&gt;i <span class="hljs-keyword">then</span> ok=<span class="hljs-number">0</span>
    <span class="hljs-keyword">next</span> i
    r$=<span class="hljs-string">"failure"</span>
    <span class="hljs-keyword">if</span> ok <span class="hljs-keyword">then</span> r$=<span class="hljs-string">"success"</span>
<span class="hljs-keyword">end</span> <span class="hljs-keyword">sub</span>

<span class="hljs-comment">'main game</span>
print <span class="hljs-string">"write number form 0 to 9"</span>
result$=<span class="hljs-string">"       "</span>
keyboard <span class="hljs-keyword">on</span>
randomize timer
<span class="hljs-keyword">do</span>
    k$=inkey$
    <span class="hljs-keyword">if</span> k$&lt;&gt;<span class="hljs-string">""</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">call</span> handle(k$)
    wait vbl
    <span class="hljs-keyword">call</span> check(result$)
    <span class="hljs-keyword">text</span> <span class="hljs-number">0</span>,<span class="hljs-number">2</span>,result$
<span class="hljs-keyword">loop</span>
</code></pre><blockquote>
<p>This example show proceduces without argument: <code>perturb</code>, <code>delete</code>, proceduce that take one input argument <code>handle</code> and one proceduce that will output a value in the parameter <code>check</code></p>
</blockquote>
<hr />
<p><strong>Exiting early.</strong></p>
<p>Syntax:</p>
<pre><code><span class="hljs-keyword">EXIT</span> <span class="hljs-keyword">SUB</span>
</code></pre><p>TODO: wait for next do loop repeat until while wend exit sub end sub call exit sub global dim</p>
<p>TODO: GOTO inside SUB</p>
<p>TODO: playing with GOSUB and RETURN</p>
<p>TODO: ON GOSUB</p>
<p>TODO: language instructions</p>
<p>TODO: about comments</p>
<p>TODO: on restore</p>
<h1 id="api-instructions">API instructions</h1>
<h2 id="background-api">Background API</h2>
<blockquote>
<p><a href="#backgrounds">How backgrounds works</a></p>
</blockquote>
<h3 id="cell-s-attributes">Cell's attributes</h3>
<p><code>BG layer</code></p>
<p>Change the current background to <code>layer</code> for further cells operations.</p>
<p>Wait <code>layer</code> a number from <code>0</code> to <code>3</code>.</p>
<pre><code>TEXT <span class="hljs-number">10</span>,<span class="hljs-number">10</span>,<span class="hljs-string">"/"</span>
BG <span class="hljs-number">1</span>
TEXT <span class="hljs-number">10</span>,<span class="hljs-number">10</span>,<span class="hljs-string">"<span class="hljs-subst">\"</span></span>
</code></pre><hr />
<p><code>PAL p</code></p>
<p>Change the current palette to <code>p</code> for further cells operations.</p>
<pre><code><span class="hljs-keyword">PRINT</span> <span class="hljs-string">"HELLO"</span>,
PAL <span class="hljs-number">1</span>
<span class="hljs-keyword">PRINT</span> <span class="hljs-string">"WORLD"</span>
</code></pre><hr />
<p><code>FLIP h,v</code></p>
<p>Change the horizontal and vertical flip attributes to <code>h</code> and <code>v</code> respectively for further cells operations.</p>
<pre><code>FLIP <span class="hljs-number">1</span>,<span class="hljs-number">0</span>
PRINT <span class="hljs-string">"DLROW OLLEH"</span>
</code></pre><hr />
<p><code>PRIO p</code></p>
<p>Change the priority to <code>p</code> for further cells operations.</p>
<pre><code><span class="hljs-attribute">SPRITE</span> <span class="hljs-number">0</span>,<span class="hljs-number">78</span>,<span class="hljs-number">78</span>,<span class="hljs-number">1</span>
PRIO <span class="hljs-number">1</span>
TEXT <span class="hljs-number">10</span>,<span class="hljs-number">10</span>,<span class="hljs-string">"S"</span>
<span class="hljs-comment">#2:MAIN CHARACTERS</span>
<span class="hljs-number">00000000000000000000000000000000</span>
003C7E6A7E7E3C000000183C00000000
</code></pre><h3 id="background-s-cell">Background's cell</h3>
<p><code>BG FILL x1,y1 TO x2,y2 CHAR c</code></p>
<p>Fills all cells from <code>x1</code>,<code>y1</code> coordinates to <code>x2</code>,<code>y2</code> with character <code>c</code> and the <a href="#cells-attributes">current attributes</a>.</p>
<pre><code>BG FILL <span class="hljs-number">1</span>,<span class="hljs-number">1</span> <span class="hljs-built_in">to</span> <span class="hljs-number">5</span>,<span class="hljs-number">5</span> <span class="hljs-keyword">char</span> <span class="hljs-number">1</span>
BG FILL <span class="hljs-number">2</span>,<span class="hljs-number">2</span> <span class="hljs-built_in">to</span> <span class="hljs-number">4</span>,<span class="hljs-number">4</span> <span class="hljs-keyword">char</span> <span class="hljs-number">2</span>
<span class="hljs-comment">#2:MAIN CHARACTERS</span>
<span class="hljs-number">00000000000000000000000000000000</span>
FFFFFFFFFFFFFFFF0000000000000000
<span class="hljs-number">0000000000000000</span>FFFFFFFFFFFFFFFF
</code></pre><p><code>CLS</code></p>
<p>Clear all background layers with character zero <code>0</code>, resets the current window to the default and the backgrounds scrolling values.</p>
<p><code>CLS layer</code></p>
<p>Only clear the background numbered <code>layer</code> with character zero <code>0</code>. Do not alter the scrolling value.</p>
<hr />
<p><code>CELL cx,cy,c</code></p>
<p>Sets the cell of the current background at <code>cx</code>,<code>cy</code> coordinates to the character <code>c</code> with the <a href="#cells-attributes">current attributes</a>.</p>
<p>E.g. draw a face:</p>
<pre><code><span class="hljs-selector-tag">CELL</span> 10,10,1
<span class="hljs-selector-id">#2</span><span class="hljs-selector-pseudo">:MAIN</span> <span class="hljs-selector-tag">CHARACTERS</span>
00000000000000000000000000000000
003<span class="hljs-selector-tag">C7E6A7E7E3C000000183C00000000</span>
</code></pre><blockquote>
<p>Use <code>BG</code>, <code>PAL</code>, <code>FLIP</code>, <code>PRIO</code> and <code>ATTR</code> to alter the <a href="#cells-attributes">current attributes</a>.</p>
</blockquote>
<hr />
<p><code>=CELL.C(cx,cy)</code></p>
<p>Return the character of the current background at <code>cx</code>,<code>cy</code> coordinates.</p>
<hr />
<p>TODO: continue</p>
<h3 id="cell-attributes">Cell attributes</h3>
<h3 id="background-s-layer">Background's layer</h3>
<h3 id="background-s-memory">Background's memory</h3>
<p><code>BG COPY sx,sy,sw,sh TO dx,dy</code></p>
<p>Copies cell's informations (characters and attributes) from memory source to current background.</p>
<p>Copies a rectangle at <code>sx</code>,<code>sy</code> coordinates and <code>sw</code>,<code>sh</code> size from the source, and paste it to the background at <code>dx</code>,<code>dy</code>.</p>
<blockquote>
<p>By default the source data point to <code>=ROM(3)</code>, changes it using <code>BG SOURCE ROM(4)</code>.</p>
</blockquote>
<pre><code>BG SOURCE ROM(<span class="hljs-number">4</span>)
BG <span class="hljs-keyword">COPY</span><span class="bash"> 0,0,4,1 to 4,4
</span><span class="hljs-comment">#2:MAIN CHARACTERS</span>
<span class="hljs-number">00000000000000000000000000000000</span>
FFFFFFFFFFFFFFFF0000000000000000
<span class="hljs-number">0000000000000000</span>FFFFFFFFFFFFFFFF
<span class="hljs-comment">#4:TEST BG</span>
<span class="hljs-number">000004010100020001000200</span>
</code></pre><hr />
<p><code>BG SOURCE a</code><br />
<code>BG SOURCE a,w,h</code></p>
<p>Specify the memory address <code>a</code> where source data will be used for background copy operations. Intended to be used jointly with <code>BG COPY sx,sy,sw,sh TO dx,dy</code>.</p>
<p>When width and height <code>w,h</code> are omitted, the first 4 bytes from memory are used to detect and store the <code>w</code> and <code>h</code> parameters. Actual data start at <code>a+4</code>.</p>
<table>
<thead>
<tr>
<th>addr</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>a+0</td>
<td>always zero</td>
</tr>
<tr>
<td>a+1</td>
<td>always zero</td>
</tr>
<tr>
<td>a+2</td>
<td>width in cell</td>
</tr>
<tr>
<td>a+3</td>
<td>height in cell</td>
</tr>
<tr>
<td>a+4</td>
<td>cell's data</td>
</tr>
<tr>
<td>...</td>
</tr>
</tbody>
</table>
<p>When width and height <code>w,h</code> are provided, the actual data start at <code>a</code>.</p>
<blockquote>
<p>By default the source data point to <code>=ROM(3)</code>.</p>
</blockquote>
<hr />
<p><code>MCELL cx,cy,c</code></p>
<p>Similar to <code>CELL cx,cy,c</code> but modify the source in memory instead of the current background.</p>
<p>The source must point to writable memory, so it will not work with <code>BG SOURCE ROM(3)</code>.</p>
<p>TODO: example</p>
<p>TODO: continue</p>
<p>TODO: API</p>
<p>TODO: touch screen</p>
<p>TODO: about memory</p>
<p>TODO: about sound</p>
<p>TODO: about priority</p>
<p>TODO: about keywords</p>
<p>TODO: about numeric technical</p>
<p>TODO: how window not updated when on-resized</p>
<h1 id="registers">Registers</h1>
<p>Sprite Registers:</p>
<p>There are 170 sprites, each occupies 6 bytes:</p>
<table>
<thead>
<tr>
<th>addr</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>$FB00</td>
<td>6 Bytes</td>
<td>1st sprite</td>
</tr>
<tr>
<td>$FB06</td>
<td>6 Bytes</td>
<td>2nd sprite</td>
</tr>
<tr>
<td>$FB0C</td>
<td>6 Bytes</td>
<td>3rd sprite</td>
</tr>
<tr>
<td>‚Ä¶</td>
<td></td>
<td>‚Ä¶</td>
</tr>
<tr>
<td>$FEF6</td>
<td>6 Bytes</td>
<td>170th sprite</td>
</tr>
<tr>
<td>$FEFC</td>
<td>4 Bytes</td>
<td>Not used</td>
</tr>
</tbody>
</table>
<p>For each sprite:</p>
<table>
<thead>
<tr>
<th>offset</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>+0</td>
<td>2 Bytes</td>
<td>Position on X axis</td>
</tr>
<tr>
<td>+2</td>
<td>2 Bytes</td>
<td>Position on Y axis</td>
</tr>
<tr>
<td>+4</td>
<td>1 Byte</td>
<td>Character number</td>
</tr>
<tr>
<td>+5</td>
<td>1 Byte</td>
<td>Character attributes</td>
</tr>
</tbody>
</table>
<p>Both position on x and y axis use sub-pixels values. To advance by 1 pixel, the values should get increased by 16.
Also, they are both offseted by 32 pixels. To place a sprite in the 0x0 coordinates, the values should be 512x512.</p>
<p>Attributes bits:</p>
<table>
<thead>
<tr>
<th>bits</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>0..2</td>
<td>Palette number</td>
</tr>
<tr>
<td>3</td>
<td>Horizontal flip</td>
</tr>
<tr>
<td>4</td>
<td>Vertical flip</td>
</tr>
<tr>
<td>5</td>
<td>Priority</td>
</tr>
<tr>
<td>6..7</td>
<td>Size</td>
</tr>
</tbody>
</table>
<p>Sprite size:</p>
<table>
<thead>
<tr>
<th>binary</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>%00</td>
<td>8x8 pixels or 1x1 character</td>
</tr>
<tr>
<td>%01</td>
<td>16x16 pixels or 2x2 characters</td>
</tr>
<tr>
<td>%10</td>
<td>24x24 pixels or 3x3 characters</td>
</tr>
<tr>
<td>%11</td>
<td>32x32 pixels or 4x4 characters</td>
</tr>
</tbody>
</table>
<hr />
<p>Color registers:</p>
<p>There are 8 palettes with 4 colors each:</p>
<table>
<thead>
<tr>
<th>addr</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>$FF00</td>
<td>32 Bytes</td>
<td>Color registers</td>
</tr>
</tbody>
</table>
<p>For each palette:</p>
<table>
<thead>
<tr>
<th>offset</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>+0</td>
<td>1 Byte</td>
<td>1st color value</td>
</tr>
<tr>
<td>+1</td>
<td>1 Byte</td>
<td>2nd color value</td>
</tr>
<tr>
<td>+2</td>
<td>1 Byte</td>
<td>3rd color value</td>
</tr>
<tr>
<td>+3</td>
<td>1 Byte</td>
<td>4th color value</td>
</tr>
</tbody>
</table>
<hr />
<p>Video registers:</p>
<table>
<thead>
<tr>
<th>addr</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>$FF20</td>
<td>2 Bytes</td>
<td>Background layer 0 scroll X</td>
</tr>
<tr>
<td>$FF22</td>
<td>2 Bytes</td>
<td>Background layer 0 scroll Y</td>
</tr>
<tr>
<td>$FF24</td>
<td>2 Bytes</td>
<td>Background layer 1 scroll X</td>
</tr>
<tr>
<td>$FF26</td>
<td>2 Bytes</td>
<td>Background layer 1 scroll Y</td>
</tr>
<tr>
<td>$FF28</td>
<td>2 Bytes</td>
<td>Background layer 2 scroll X</td>
</tr>
<tr>
<td>$FF2A</td>
<td>2 Bytes</td>
<td>Background layer 2 scroll Y</td>
</tr>
<tr>
<td>$FF2C</td>
<td>2 Bytes</td>
<td>Background layer 3 scroll X</td>
</tr>
<tr>
<td>$FF2E</td>
<td>2 Bytes</td>
<td>Background layer 3 scroll Y</td>
</tr>
<tr>
<td>$FF30</td>
<td>2 Bytes</td>
<td>Raster line number</td>
</tr>
<tr>
<td>$FF32</td>
<td>1 Byte</td>
<td>Display attributes</td>
</tr>
<tr>
<td>$FF33</td>
<td>12 Bytes</td>
<td>Not used</td>
</tr>
</tbody>
</table>
<p>Display attributes:</p>
<table>
<thead>
<tr>
<th>bits</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Sprites enabled</td>
</tr>
<tr>
<td>1</td>
<td>Background layer 0 enabled</td>
</tr>
<tr>
<td>2</td>
<td>Background layer 1 enabled</td>
</tr>
<tr>
<td>3</td>
<td>Background layer 2 enabled</td>
</tr>
<tr>
<td>4</td>
<td>Background layer 3 enabled</td>
</tr>
</tbody>
</table>
<hr />
<p>TODO: Audio registers:</p>
<table>
<thead>
<tr>
<th>addr</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>$FF40</td>
<td>48 Bytes</td>
<td>Audio registers</td>
</tr>
</tbody>
</table>
<hr />
<p>I/O registers:</p>
<table>
<thead>
<tr>
<th>addr</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>$FF70</td>
<td>4 Bytes</td>
<td>Last touch position X</td>
</tr>
<tr>
<td>$FF74</td>
<td>4 Bytes</td>
<td>Last touch position Y</td>
</tr>
<tr>
<td>$FF78</td>
<td>2 Bytes</td>
<td>Pixels shown in width</td>
</tr>
<tr>
<td>$FF7a</td>
<td>2 Bytes</td>
<td>Pixels shown in height</td>
</tr>
<tr>
<td>$FF7c</td>
<td>2 Bytes</td>
<td>Pixels outside the safe zone</td>
</tr>
<tr>
<td>$FF7e</td>
<td>2 Bytes</td>
<td>Pixels outside the safe zone</td>
</tr>
<tr>
<td>$FF80</td>
<td>2 Bytes</td>
<td>Pixels outside the safe zone</td>
</tr>
<tr>
<td>$FF82</td>
<td>2 Bytes</td>
<td>Pixels outside the safe zone</td>
</tr>
<tr>
<td>$FF84</td>
<td>1 Byte</td>
<td>ASCII code of last pressed key</td>
</tr>
<tr>
<td>$FF85</td>
<td>1 Byte</td>
<td>Other I/O status bits</td>
</tr>
</tbody>
</table>
<p>Last touch position X and Y are stored as float and currently LowResRMX do not have a way to peek float from memory, use TOUCH.X and TOUCH.Y function instead.</p>
<p>Pixels shown represent the number of fantasy pixels that is visible by the user according to their device screen ratio. TODO: link See: SHOWN.W/H</p>
<p>Pixels outsied the safe zone represent the number of fantasy pixels that are visible but should be considered unsafe for touch input as they are outside the safe area. TODO: link See: SAFE.L/T/R/B</p>
<p>Other I/O status bits:</p>
<table>
<thead>
<tr>
<th>bits</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Pause currently active</td>
</tr>
<tr>
<td>1</td>
<td>Fantasy screen currently touched</td>
</tr>
<tr>
<td>2</td>
<td>Device virtual keyboard currently visible</td>
</tr>
</tbody>
</table>
<hr />
<p>DMA registers:</p>
<table>
<thead>
<tr>
<th>addr</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>$FFA0</td>
<td>2 Bytes</td>
<td>Source address</td>
</tr>
<tr>
<td>$FFA2</td>
<td>2 Bytes</td>
<td>Number of bytes to copy</td>
</tr>
<tr>
<td>$FFA4</td>
<td>2 Bytes</td>
<td>Destination address</td>
</tr>
</tbody>
</table>











</body>
</html>
